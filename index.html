<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pummel Party Mobile 3D</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; touch-action: none; }
        #ui { 
            position: absolute; 
            bottom: 30px; 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            pointer-events: none;
        }
        .info {
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            margin-bottom: 10px;
            font-family: sans-serif;
            backdrop-filter: blur(5px);
        }
        button { 
            pointer-events: auto;
            background: linear-gradient(135deg, #ff9d00 0%, #ed6a10 100%);
            border: none; 
            padding: 15px 40px; 
            font-size: 22px; 
            color: white; 
            border-radius: 50px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            font-weight: bold;
        }
        button:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <div id="ui">
        <div class="info" id="status">Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ 1 ğŸ²</div>
        <button id="rollBtn">Ø§Ø±Ù…ÙŠ Ø§Ù„Ù†Ø±Ø¯!</button>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ù‡Ø¯ ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0f172a);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 8, 10);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio); // Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ø¬ÙˆØ¯Ø© Ø´Ø§Ø´Ø© Ø§Ù„Ù‡Ø§ØªÙ
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // --- Ø¥Ø¶Ø§Ø¡Ø© Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠØ© ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffffff, 100);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        // --- Ø¨Ù†Ø§Ø¡ Ù…Ø³Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        const pathPoints = [];
        for(let i=0; i<12; i++) {
            const angle = (i / 12) * Math.PI * 2;
            pathPoints.push({ x: Math.cos(angle) * 5, z: Math.sin(angle) * 5 });
        }

        pathPoints.forEach(p => {
            const box = new THREE.Mesh(
                new THREE.BoxGeometry(1.5, 0.4, 1.5),
                new THREE.MeshStandardMaterial({ color: 0x334155, metalness: 0.6, roughness: 0.2 })
            );
            box.position.set(p.x, 0, p.z);
            scene.add(box);
        });

        // --- Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ---
        const colors = [0xff4757, 0x2ed573, 0x1e90ff];
        const players = colors.map(color => {
            const p = new THREE.Mesh(
                new THREE.CapsuleGeometry(0.3, 0.5, 4, 8),
                new THREE.MeshStandardMaterial({ color: color })
            );
            return { mesh: p, posIndex: 0 };
        });
        players.forEach(p => scene.add(p.mesh));

        let turn = 0;

        function updatePositions() {
            players.forEach((p, i) => {
                const target = pathPoints[p.posIndex];
                // Ø¥Ø²Ø§Ø­Ø© Ø¨Ø³ÙŠØ·Ø© Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨
                p.mesh.position.set(target.x + (i*0.2 - 0.2), 0.6, target.z);
            });
        }

        // --- Ø­Ø¯Ø« Ø§Ù„Ù†Ø±Ø¯ ---
        document.getElementById('rollBtn').onclick = () => {
            const roll = Math.floor(Math.random() * 6) + 1;
            players[turn].posIndex = (players[turn].posIndex + roll) % pathPoints.length;
            
            turn = (turn + 1) % 3;
            document.getElementById('status').innerText = `Ø§Ù„Ù„Ø§Ø¹Ø¨ ${turn + 1} Ø±Ù…Ù‰ ${roll} ğŸ²`;
            updatePositions();
        };

        // --- Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        updatePositions();
        animate();

        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>
